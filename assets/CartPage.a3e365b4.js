import{ax as B,aa as g,d as x,aW as U,m as y,p as N,q as r,s as A,ab as q,ac as b,t as o,x as n,A as C,v as l,Q as i,bc as F,B as I,bd as L,be as P,C as c,W as D,aA as T,ad as z,ae as E,af as M,bf as W,z as Y,ag as j,ah as V}from"./index.2cc57376.js";import{Q as p}from"./QInput.fca396b6.js";import{Q as w}from"./QCard.87904719.js";import{Q as G}from"./QForm.08959a12.js";const H={class:"row bg-secondary q-mx-auto rounded",style:{width:"80%"}},J={class:"col"},K={class:"text-center text-white"},O={class:"col"},R=c("\u7D50\u5E33"),X={class:"row"},Z={flat:"",class:"col",col:"10"},tt={class:"col",col:"10"},et={class:"row"},at={class:"col",col:"6"},st={class:"col",col:"6"},ot={class:"text-center q-ma-md"},lt={class:"row q-ml-lg"},rt=["src"],nt={class:"row rounded q-pa-md",style:{width:"100%",background:"rgba(117, 181, 152, 0.5)","margin-top":"-10px"}},dt={class:"col col-10"},it=c("\u522A\u9664"),ct={class:"col col-2"},ut=c(" - "),mt=c(" + "),bt={__name:"CartPage",setup(pt){const f=B(),u=g([]),d=g([]),k=x(()=>d.reduce((s,a)=>s+a.product.price*a.quantity,0)),Q=x(()=>d.length>0&&!d.some(s=>!s.product.sell)),t=g({_id:"",firstName:"",lastName:"",phone:"",email:"",idx:-1,dialog:!1,submitting:!1}),$=s=>{t._id=s;const a=s===""?-1:f.orderInfo.findIndex(m=>m._id===s);a>-1?(t.lastName=u[a].lastName,t.firstName=u[a].firstName,t.phone=u[a].phone,t.email=u[a].email):(t.lastName="",t.firstName="",t.phone="",t.email=""),t.idx=a,t.dialog=!0,t.submitting=!1,console.log(t.lastName)},S=async()=>{t.submitting=!0;try{t._id.length===0&&(await q.post("/users/order",{_id:t._id,lastName:t.lastName,firstName:t.firstName,phone:t.phone,email:t.email}),b.fire({icon:"success",title:"\u6210\u529F",text:"\u65B0\u589E\u8A02\u55AE\u6210\u529F"})),t.dialog=!1}catch(s){b.fire({icon:"error",title:"\u5931\u6557",text:s.isAxiosError?s.response.data.message:s.message})}t.submitting=!1,await f.checkout()},_=async(s,a)=>{await f.updateCart({product:d[s].product._id,quantity:a})&&(a===0?d.splice(s,1):d[s].quantity=a)};return(async()=>{try{const{data:s}=await q.get("/users/cart");d.push(...s.result)}catch{b.fire({icon:"error",title:"\u5931\u6557",text:"\u4F3A\u670D\u5668\u932F\u8AA4"})}})(),(s,a)=>{const m=U("q-card-action");return y(),N(A,{class:"q-mt-md",style:{height:"calc(100% - 60px)","min-height":"calc(100% - 60px)"}},{default:r(()=>[o("div",H,[o("div",J,[o("h3",K," \u7E3D\u91D1\u984D $ "+n(C(k)),1)]),o("div",O,[l(i,{class:"text-center text-white q-my-auto",color:"accent",onClick:a[0]||(a[0]=e=>$("")),disabled:!C(Q)},{default:r(()=>[R]),_:1},8,["disabled"])]),l(z,{seamless:"",modelValue:t.dialog,"onUpdate:modelValue":a[5]||(a[5]=e=>t.dialog=e),persistent:""},{default:r(()=>[l(w,{id:"dialog"},{default:r(()=>[l(F,null,{default:r(()=>[l(I,{src:L,width:"35px",style:{"margin-top":"-5px"}}),l(P,{class:"text-weight-bold text-primary"},{default:r(()=>[c(n(s.$t("contactInfo")),1)]),_:1}),D(l(i,{flat:"",round:"",dense:"",icon:"close"},null,512),[[V]])]),_:1}),l(G,{onSubmit:T(S,["prevent"])},{default:r(()=>[l(w,{flat:""},{default:r(()=>[o("div",X,[o("div",Z,[l(p,{rounded:"",flat:"",primary:"",standout:"",modelValue:t.firstName,"onUpdate:modelValue":a[1]||(a[1]=e=>t.firstName=e),label:s.$t("firstName"),class:"q-ma-md"},null,8,["modelValue","label"])]),o("div",tt,[l(p,{rounded:"",flat:"",primary:"",standout:"",modelValue:t.lastName,"onUpdate:modelValue":a[2]||(a[2]=e=>t.lastName=e),label:s.$t("lastName"),class:"q-ma-md",style:{"box-shadow":"none"}},null,8,["modelValue","label"])])]),o("div",et,[o("div",at,[l(p,{rounded:"",flat:"",primary:"",standout:"",modelValue:t.phone,"onUpdate:modelValue":a[3]||(a[3]=e=>t.phone=e),label:s.$t("phone"),class:"q-ma-md",style:{"box-shadow":"none"}},null,8,["modelValue","label"])]),o("div",st,[l(p,{rounded:"",flat:"",primary:"",standout:"",modelValue:t.email,"onUpdate:modelValue":a[4]||(a[4]=e=>t.email=e),label:"Email",class:"q-ma-md",style:{"box-shadow":"none"}},null,8,["modelValue"])])]),l(m,{class:"text-center"},{default:r(()=>[o("div",ot,[D(l(i,{type:"submit",label:s.$t("submit"),color:"primary",loading:t.submitting},null,8,["label","loading"]),[[V]])])]),_:1})]),_:1})]),_:1},8,["onSubmit"])]),_:1})]),_:1},8,["modelValue"])]),(y(!0),E(j,null,M(d,(e,h)=>(y(),N(w,{flat:"",key:e._id,class:W([{"bg-red":!e.product.sell},"q-mx-auto q-ma-sm q-pa-md"]),style:{width:"90%"}},{default:r(()=>[o("div",lt,[l(Y,{size:"200px",style:{background:"white"}},{default:r(()=>[o("img",{src:e.product.image,alt:""},null,8,rt)]),_:2},1024)]),o("div",nt,[o("div",dt,[o("h4",null,n(e.product.name),1),o("h6",null,"$ "+n(e.product.price),1),o("h6",null,n(new Date(e.product.startDay).getFullYear().toLocaleString())+"."+n(new Date(e.product.startDay).getMonth()+1)+"."+n(new Date(e.product.startDay).getDate().toLocaleString())+" ~ "+n(new Date(e.product.endDay).getFullYear().toLocaleString())+"."+n(new Date(e.product.endDay).getMonth()+1)+"."+n(new Date(e.product.endDay).getDate().toLocaleString()),1),c(" "+n(e.product.price*e.quantity)+" ",1),l(i,{color:"primary",onClick:v=>_(h,0)},{default:r(()=>[it]),_:2},1032,["onClick"])]),o("div",ct,[l(i,{color:"primary",onClick:v=>_(h,e.quantity-1),variant:"text"},{default:r(()=>[ut]),_:2},1032,["onClick"]),o("h4",null,n(e.quantity),1),l(i,{color:"primary",onClick:v=>_(h,e.quantity+1),variant:"text"},{default:r(()=>[mt]),_:2},1032,["onClick"])])])]),_:2},1032,["class"]))),128))]),_:1})}}};export{bt as default};
