import{ay as U,ab as g,d as x,aX as I,m as b,p as N,q as r,ac as q,ad as y,s as o,v as n,z as V,t as l,Q as d,bd as S,A,be as P,bf as T,B as c,V as C,aB as z,ae as E,af as F,ag as L,bg as M,y as X,ah as j,ai as Q}from"./index.872c6a74.js";import{Q as p}from"./QInput.5bf61c9d.js";import{Q as v}from"./QCard.a12eaa3b.js";import{Q as G}from"./QForm.eb82bef6.js";import{Q as H}from"./QPage.835cef60.js";const J={class:"row bg-secondary q-mx-auto rounded",style:{width:"80%"}},K={class:"col"},O={class:"text-center text-white"},R={class:"col"},W=c("\u7D50\u5E33"),Y={class:"row"},Z={flat:"",class:"col",col:"10"},tt={class:"col",col:"10"},et={class:"row"},at={class:"col",col:"6"},st={class:"col",col:"6"},ot={class:"text-center q-ma-md"},lt={class:"row q-ml-lg"},rt=["src"],it={class:"row rounded q-pa-md",style:{width:"100%",background:"rgba(117, 181, 152, 0.5)","margin-top":"-10px"}},nt={class:"col col-10"},dt=c("\u522A\u9664"),ct={class:"col col-2"},ut=c(" - "),mt=c(" + "),vt={__name:"CartPage",setup(pt){const f=U(),u=g([]),i=g([]),k=x(()=>i.reduce((a,e)=>a+e.product.price*e.quantity,0)),$=x(()=>i.length>0&&!i.some(a=>!a.product.sell)),t=g({_id:"",firstName:"",lastName:"",phone:"",email:"",idx:-1,dialog:!1,submitting:!1}),B=a=>{t._id=a;const e=a===""?-1:f.orderInfo.findIndex(m=>m._id===a);e>-1?(t.lastName=u[e].lastName,t.firstName=u[e].firstName,t.phone=u[e].phone,t.email=u[e].email):(t.lastName="",t.firstName="",t.phone="",t.email=""),t.idx=e,t.dialog=!0,t.submitting=!1,console.log(t.lastName)},D=async()=>{t.submitting=!0;try{t._id.length===0&&(await q.post("/users/order",{_id:t._id,lastName:t.lastName,firstName:t.firstName,phone:t.phone,email:t.email}),y.fire({icon:"success",title:"\u6210\u529F",text:"\u65B0\u589E\u8A02\u55AE\u6210\u529F"})),t.dialog=!1}catch(a){y.fire({icon:"error",title:"\u5931\u6557",text:a.isAxiosError?a.response.data.message:a.message})}t.submitting=!1,await f.checkout()},_=async(a,e)=>{await f.updateCart({product:i[a].product._id,quantity:e})&&(e===0?i.splice(a,1):i[a].quantity=e)};return(async()=>{try{const{data:a}=await q.get("/users/cart");i.push(...a.result)}catch{y.fire({icon:"error",title:"\u5931\u6557",text:"\u4F3A\u670D\u5668\u932F\u8AA4"})}})(),(a,e)=>{const m=I("q-card-action");return b(),N(H,{class:"q-mt-md",style:{height:"calc(100% - 60px)","min-height":"calc(100% - 60px)"}},{default:r(()=>[o("div",J,[o("div",K,[o("h3",O," \u7E3D\u91D1\u984D $ "+n(V(k)),1)]),o("div",R,[l(d,{class:"text-center text-white q-my-auto",color:"accent",onClick:e[0]||(e[0]=s=>B("")),disabled:!V($)},{default:r(()=>[W]),_:1},8,["disabled"])]),l(E,{seamless:"",modelValue:t.dialog,"onUpdate:modelValue":e[5]||(e[5]=s=>t.dialog=s),persistent:""},{default:r(()=>[l(v,{id:"dialog"},{default:r(()=>[l(S,null,{default:r(()=>[l(A,{src:P,width:"35px",style:{"margin-top":"-5px"}}),l(T,{class:"text-weight-bold text-primary"},{default:r(()=>[c(n(a.$t("contactInfo")),1)]),_:1}),C(l(d,{flat:"",round:"",dense:"",icon:"close"},null,512),[[Q]])]),_:1}),l(G,{onSubmit:z(D,["prevent"])},{default:r(()=>[l(v,{flat:""},{default:r(()=>[o("div",Y,[o("div",Z,[l(p,{rounded:"",flat:"",primary:"",standout:"",modelValue:t.firstName,"onUpdate:modelValue":e[1]||(e[1]=s=>t.firstName=s),label:a.$t("firstName"),class:"q-ma-md"},null,8,["modelValue","label"])]),o("div",tt,[l(p,{rounded:"",flat:"",primary:"",standout:"",modelValue:t.lastName,"onUpdate:modelValue":e[2]||(e[2]=s=>t.lastName=s),label:a.$t("lastName"),class:"q-ma-md",style:{"box-shadow":"none"}},null,8,["modelValue","label"])])]),o("div",et,[o("div",at,[l(p,{rounded:"",flat:"",primary:"",standout:"",modelValue:t.phone,"onUpdate:modelValue":e[3]||(e[3]=s=>t.phone=s),label:a.$t("phone"),class:"q-ma-md",style:{"box-shadow":"none"}},null,8,["modelValue","label"])]),o("div",st,[l(p,{rounded:"",flat:"",primary:"",standout:"",modelValue:t.email,"onUpdate:modelValue":e[4]||(e[4]=s=>t.email=s),label:"Email",class:"q-ma-md",style:{"box-shadow":"none"}},null,8,["modelValue"])])]),l(m,{class:"text-center"},{default:r(()=>[o("div",ot,[C(l(d,{type:"submit",label:a.$t("submit"),color:"primary",loading:t.submitting},null,8,["label","loading"]),[[Q]])])]),_:1})]),_:1})]),_:1},8,["onSubmit"])]),_:1})]),_:1},8,["modelValue"])]),(b(!0),F(j,null,L(i,(s,h)=>(b(),N(v,{flat:"",key:s._id,class:M([{"bg-red":!s.product.sell},"q-mx-auto q-ma-sm q-pa-md"]),style:{width:"90%"}},{default:r(()=>[o("div",lt,[l(X,{size:"200px",style:{background:"white"}},{default:r(()=>[o("img",{src:s.product.image,alt:""},null,8,rt)]),_:2},1024)]),o("div",it,[o("div",nt,[o("h4",null,n(s.product.name),1),o("h6",null,"$ "+n(s.product.price),1),o("h6",null,n(s.product.startDay)+" ~ "+n(s.product.endDay),1),c(" "+n(s.product.price*s.quantity)+" ",1),l(d,{color:"primary",onClick:w=>_(h,0)},{default:r(()=>[dt]),_:2},1032,["onClick"])]),o("div",ct,[l(d,{color:"primary",onClick:w=>_(h,s.quantity-1),variant:"text"},{default:r(()=>[ut]),_:2},1032,["onClick"]),o("h4",null,n(s.quantity),1),l(d,{color:"primary",onClick:w=>_(h,s.quantity+1),variant:"text"},{default:r(()=>[mt]),_:2},1032,["onClick"])])])]),_:2},1032,["class"]))),128))]),_:1})}}};export{vt as default};
