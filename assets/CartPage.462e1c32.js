import{aD as R,a9 as x,d as $,m as d,p as c,q as n,s as T,aa as V,ab as N,b1 as S,t as a,v as o,b8 as Z,C as D,b9 as j,ba as F,A as m,x as i,V as L,Q as u,aG as W,y as E,B as f,aH as G,ac as p,ad as z,ae as A,aZ as H,af as M}from"./index.a1356615.js";import{Q as v}from"./QInput.25897666.js";import{Q as w}from"./QCard.7a4cbe67.js";import{Q as O}from"./QForm.66df6ef4.js";import{Q as J}from"./QDialog.f5cd691a.js";import{Q as P}from"./QCardSection.767920cb.js";import{Q as K}from"./QCardActions.c927933e.js";const X={class:"box",style:{height:"300px"}},Y=a("div",{class:"img1 q-my-auto"},null,-1),ee=a("div",{class:"img2 q-my-auto"},null,-1),te={class:"row"},se={flat:"",class:"col",col:"10"},ae={class:"col",col:"10"},le={class:"row"},oe={class:"col",col:"6"},ne={class:"col",col:"6"},ie={class:"text-center q-ma-md"},de={class:"box",style:{"margin-top":"20px"}},re={class:"box"},ce={class:"row text-center"},ue={class:"text-center q-mx-auto q-my-md q-mt-lg text-secondary",style:{padding:"0"}},me={class:"row"},pe={class:"col col-12 col-md-3"},_e=a("div",{class:"row bg-secondary q-mx-auto rounded",style:{width:"80%"}},null,-1),fe={class:"col"},he={class:"text-center text-white q-pb-lg"},ye={style:{"margin-bottom":"0","margin-top":"10px"},class:"text-dark"},ge={style:{"margin-top":"10px","margin-bottom":"10px"},class:"text-dark"},be={key:2,class:"q-my-md text-red"},xe={key:3,class:"q-my-md text-red"},ve={class:"col col-12 col-md-9"},we={class:"row"},qe={class:"text-h5 absolute-bottom text-right",style:{"border-radius":"16px"}},ke={class:"flex row justify-between"},Ce={class:"text-h5 text-accent"},Ne={class:"text-subtitle1"},Qe={class:"text-subtitle2 text-accent",style:{"font-size":"1.5vmin"}},$e={class:"div"},Re={__name:"CartPage",setup(Ve){const q=R(),h=x([]),r=x([]),Q=x({phone:[e=>!!e||"Required",e=>e.length>=8&&e.length<=11||"Wrong",e=>/^[0-9]+$/.test(e)||"Wrong"],email:[e=>!!e||"Required",e=>/^\w+((-\w+)|(\.\w+))*@[A-Za-z0-9]+((\.|-)[A-Za-z0-9]+)*\.[A-Za-z]+$/.test(e)||"Wrong"]}),B=$(()=>r.reduce((e,l)=>e+l.product.price*l.quantity,0)),y=$(()=>r.length>0&&!r.some(e=>!e.product.sell)),s=x({_id:"",firstName:"",lastName:"",phone:"",email:"",idx:-1,dialog:!1,submitting:!1}),I=e=>{s._id=e;const l=e===""?-1:q.orderInfo.findIndex(_=>_._id===e);l>-1?(s.lastName=h[l].lastName,s.firstName=h[l].firstName,s.phone=h[l].phone,s.email=h[l].email):(s.lastName="",s.firstName="",s.phone="",s.email=""),s.idx=l,s.dialog=!0,s.submitting=!1,console.log(s.lastName)},U=async()=>{s.submitting=!0;try{s._id.length===0&&(await V.post("/users/order",{_id:s._id,lastName:s.lastName,firstName:s.firstName,phone:s.phone,email:s.email}),N.fire({icon:"success",title:"Add Order Success"})),s.dialog=!1}catch{N.fire({icon:"question",title:"Please add order again"})}s.submitting=!1,await q.checkout()},g=async(e,l)=>{await q.updateCart({product:r[e].product._id,quantity:l})&&(l===0?r.splice(e,1):r[e].quantity=l)};return(async()=>{try{const{data:e}=await V.get("/users/cart");r.push(...e.result)}catch{N.fire({icon:"question",title:"Please try it again"})}})(),(e,l)=>{const _=S("q-card-action"),k=S("h7");return d(),c(T,{id:"cart",class:"q-mt-md",style:{height:"calc(100% - 60px)","min-height":"calc(100% - 60px)"}},{default:n(()=>[a("div",X,[Y,ee,o(J,{seamless:"",modelValue:s.dialog,"onUpdate:modelValue":l[4]||(l[4]=t=>s.dialog=t),persistent:""},{default:n(()=>[o(w,{id:"dialog"},{default:n(()=>[o(Z,null,{default:n(()=>[o(D,{src:j,width:"35px",style:{"margin-top":"-5px"}}),o(F,{class:"text-weight-bold text-primary"},{default:n(()=>[m(i(e.$t("contactInfo")),1)]),_:1}),L(o(u,{flat:"",round:"",dense:"",icon:"close"},null,512),[[M]])]),_:1}),o(O,{onSubmit:W(U,["prevent"])},{default:n(()=>[o(w,{flat:""},{default:n(()=>[a("div",te,[a("div",se,[o(v,{rounded:"",flat:"",outlined:"",modelValue:s.firstName,"onUpdate:modelValue":l[0]||(l[0]=t=>s.firstName=t),label:e.$t("firstName"),class:"q-ma-md","lazy-rules":"",rules:[t=>t&&t.length>0||"Required"]},null,8,["modelValue","label","rules"])]),a("div",ae,[o(v,{rounded:"",flat:"",outlined:"",modelValue:s.lastName,"onUpdate:modelValue":l[1]||(l[1]=t=>s.lastName=t),label:e.$t("lastName"),class:"q-ma-md",style:{"box-shadow":"none"},"lazy-rules":"",rules:[t=>t&&t.length>0||"Required"]},null,8,["modelValue","label","rules"])])]),a("div",le,[a("div",oe,[o(v,{rounded:"",flat:"",outlined:"",modelValue:s.phone,"onUpdate:modelValue":l[2]||(l[2]=t=>s.phone=t),label:e.$t("phone"),class:"q-ma-md",style:{"box-shadow":"none"},"lazy-rules":"",rules:Q.phone},null,8,["modelValue","label","rules"])]),a("div",ne,[o(v,{rounded:"",flat:"",outlined:"",modelValue:s.email,"onUpdate:modelValue":l[3]||(l[3]=t=>s.email=t),label:"Email",class:"q-ma-md",style:{"box-shadow":"none"},"lazy-rules":"",rules:Q.email},null,8,["modelValue","rules"])])]),o(_,{class:"text-center"},{default:n(()=>[a("div",ie,[o(u,{type:"submit",label:e.$t("submit"),color:"primary",loading:s.submitting},null,8,["label","loading"])])]),_:1})]),_:1})]),_:1},8,["onSubmit"])]),_:1})]),_:1},8,["modelValue"])]),a("div",de,[a("div",re,[a("div",ce,[a("h5",ue,[o(E,{name:"mdi-cart-variant",color:"secondary",size:"lg",class:"q-mx-auto"}),m(" "+i(e.$t("cart")),1)])])]),a("div",me,[a("div",pe,[o(w,{class:"bg-accent",style:{"box-shadow":"none","border-radius":"16px"}},{default:n(()=>[_e,a("div",fe,[a("div",he,[o(P,null,{default:n(()=>[a("h5",ye,i(e.$t("totalPrice")),1),a("h4",ge,"$ "+i(f(B)),1)]),_:1}),o(G,{white:"",inset:""}),o(P,null,{default:n(()=>[(d(!0),p(A,null,z(r,t=>(d(),p("div",{key:t._id,class:"flex justify-between"},[o(k,{style:{"text-align":"left"},class:"text-dark"},{default:n(()=>[m(i(t.product.name),1)]),_:2},1024),o(k,{style:{"text-align":"right"},class:"text-dark"},{default:n(()=>[m("$ "+i(t.product.price*t.quantity),1)]),_:2},1024)]))),128))]),_:1}),o(_,null,{default:n(()=>[f(y)?(d(),c(u,{key:0,class:"text-center text-white q-my-auto q-mb-md",color:"red",onClick:l[5]||(l[5]=t=>I(""))},{default:n(()=>[m(i(e.$t("checkout")),1)]),_:1})):(d(),c(u,{key:1,class:"text-center text-white q-my-auto q-mb-md",color:"primary",disabled:""},{default:n(()=>[m(i(e.$t("checkout")),1)]),_:1})),!f(y)&&!r.length?(d(),p("p",be,i(e.$t("noCart")),1)):f(y)?H("",!0):(d(),p("p",xe,i(e.$t("checkAgain")),1))]),_:1})])])]),_:1})]),a("div",ve,[a("div",we,[(d(!0),p(A,null,z(r,(t,b)=>(d(),p("div",{class:"col-12 col-md-6 col-lg-4",key:t._id},[(d(),c(w,{class:"my-card q-pa-sm",key:t,style:{background:"transparent","box-shadow":"none","border-radius":"16px"}},{default:n(()=>[o(D,{src:t.product.image},{default:n(()=>[a("div",qe,[a("div",ke,[a("div",Ce,i(t.product.name),1),a("div",Ne,"$"+i(t.product.price),1)]),a("div",Qe,i(new Date(t.product.startDay).toDateString().toLocaleString())+" ~ "+i(new Date(t.product.endDay).toDateString().toLocaleString()),1),o(K,{class:"flex justify-between q-px-none",style:{"padding-left":"0"}},{default:n(()=>[a("div",$e,[(d(),c(u,{round:"",flat:"",key:t._id,class:"text-accent",icon:"fa-solid fa-circle-minus",onClick:C=>g(b,t.quantity-1)},null,8,["onClick"])),o(k,null,{default:n(()=>[m(i(t.quantity),1)]),_:2},1024),(d(),c(u,{round:"",flat:"",key:t._id,class:"text-accent",icon:"fa-solid fa-circle-plus",onClick:C=>g(b,t.quantity+1)},null,8,["onClick"]))]),f(y)?(d(),c(u,{key:0,round:"",color:"secondary",icon:"mdi-delete",onClick:C=>g(b,0)},null,8,["onClick"])):(d(),c(u,{key:1,round:"",color:"red",icon:"mdi-delete",onClick:C=>g(b,0)},null,8,["onClick"]))]),_:2},1024)])]),_:2},1032,["src"])]),_:2},1024))]))),128))])])])])]),_:1})}}};export{Re as default};
