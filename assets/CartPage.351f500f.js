import{aD as R,a9 as b,d as $,m as r,p as c,q as n,s as T,aa as V,ab as N,b1 as D,t as a,v as o,b8 as Z,C as S,b9 as j,ba as E,A as m,x as i,V as F,Q as u,aG as L,y as W,B as f,aH as G,ac as p,ad as z,ae as A,aZ as H,af as M}from"./index.a1db0f0f.js";import{Q as v}from"./QInput.a56e06a8.js";import{Q as w}from"./QCard.8469dab0.js";import{Q as J}from"./QForm.30557bc3.js";import{Q as K}from"./QDialog.a6a751c8.js";import{Q as B}from"./QCardSection.96c3a010.js";import{Q as O}from"./QCardActions.6ad3c481.js";const X={class:"box",style:{height:"300px"}},Y=a("div",{class:"img1 q-my-auto"},null,-1),ee=a("div",{class:"img2 q-my-auto"},null,-1),te={class:"row"},se={flat:"",class:"col",col:"10"},ae={class:"col",col:"10"},le={class:"row"},oe={class:"col",col:"6"},ne={class:"col",col:"6"},ie={class:"text-center q-ma-md"},re={class:"box",style:{"margin-top":"20px"}},de={class:"box"},ce={class:"row text-center"},ue={class:"text-center q-mx-auto q-my-md q-mt-lg text-secondary",style:{padding:"0"}},me={class:"row"},pe={class:"col col-12 col-md-3"},_e=a("div",{class:"row bg-secondary q-mx-auto rounded",style:{width:"80%"}},null,-1),fe={class:"col"},he={class:"text-center text-white q-pb-lg"},ge={style:{"margin-bottom":"0","margin-top":"10px"},class:"text-dark"},ye={style:{"margin-top":"10px","margin-bottom":"10px"},class:"text-dark"},xe={key:2,class:"q-my-md text-red"},be={key:3,class:"q-my-md text-red"},ve={class:"col col-12 col-md-9"},we={class:"row"},ke={class:"text-h5 absolute-bottom text-right",style:{"border-radius":"16px"}},qe={class:"flex row justify-between"},Ce={class:"text-h5 text-accent"},Ne={class:"text-subtitle1"},Qe={class:"text-subtitle2 text-accent",style:{"font-size":"1.5vmin"}},$e={class:"div"},Re={__name:"CartPage",setup(Ve){const k=R(),h=b([]),d=b([]),Q=b({phone:[e=>!!e||"Required",e=>e.length>=8&&e.length<=11||"Wrong",e=>/^[0-9]+$/.test(e)||"Wrong"],email:[e=>!!e||"Required",e=>/^\w+((-\w+)|(\.\w+))*@[A-Za-z0-9]+((\.|-)[A-Za-z0-9]+)*\.[A-Za-z]+$/.test(e)||"Wrong"]}),I=$(()=>d.reduce((e,l)=>e+l.product.price*l.quantity,0)),g=$(()=>d.length>0&&!d.some(e=>!e.product.sell)),s=b({_id:"",firstName:"",lastName:"",phone:"",email:"",idx:-1,dialog:!1,submitting:!1}),P=e=>{s._id=e;const l=e===""?-1:k.orderInfo.findIndex(_=>_._id===e);l>-1?(s.lastName=h[l].lastName,s.firstName=h[l].firstName,s.phone=h[l].phone,s.email=h[l].email):(s.lastName="",s.firstName="",s.phone="",s.email=""),s.idx=l,s.dialog=!0,s.submitting=!1,console.log(s.lastName)},U=async()=>{s.submitting=!0;try{s._id.length===0&&(await V.post("/users/order",{_id:s._id,lastName:s.lastName,firstName:s.firstName,phone:s.phone,email:s.email}),N.fire({icon:"success",title:"\u6210\u529F",text:"\u65B0\u589E\u8A02\u55AE\u6210\u529F"})),s.dialog=!1}catch(e){N.fire({icon:"error",title:"\u5931\u6557",text:e.isAxiosError?e.response.data.message:e.message})}s.submitting=!1,await k.checkout()},y=async(e,l)=>{await k.updateCart({product:d[e].product._id,quantity:l})&&(l===0?d.splice(e,1):d[e].quantity=l)};return(async()=>{try{const{data:e}=await V.get("/users/cart");d.push(...e.result)}catch{N.fire({icon:"error",title:"\u5931\u6557",text:"\u4F3A\u670D\u5668\u932F\u8AA4"})}})(),(e,l)=>{const _=D("q-card-action"),q=D("h7");return r(),c(T,{id:"cart",class:"q-mt-md",style:{height:"calc(100% - 60px)","min-height":"calc(100% - 60px)"}},{default:n(()=>[a("div",X,[Y,ee,o(K,{seamless:"",modelValue:s.dialog,"onUpdate:modelValue":l[4]||(l[4]=t=>s.dialog=t),persistent:""},{default:n(()=>[o(w,{id:"dialog"},{default:n(()=>[o(Z,null,{default:n(()=>[o(S,{src:j,width:"35px",style:{"margin-top":"-5px"}}),o(E,{class:"text-weight-bold text-primary"},{default:n(()=>[m(i(e.$t("contactInfo")),1)]),_:1}),F(o(u,{flat:"",round:"",dense:"",icon:"close"},null,512),[[M]])]),_:1}),o(J,{onSubmit:L(U,["prevent"])},{default:n(()=>[o(w,{flat:""},{default:n(()=>[a("div",te,[a("div",se,[o(v,{rounded:"",flat:"",outlined:"",modelValue:s.firstName,"onUpdate:modelValue":l[0]||(l[0]=t=>s.firstName=t),label:e.$t("firstName"),class:"q-ma-md","lazy-rules":"",rules:[t=>t&&t.length>0||"Required"]},null,8,["modelValue","label","rules"])]),a("div",ae,[o(v,{rounded:"",flat:"",outlined:"",modelValue:s.lastName,"onUpdate:modelValue":l[1]||(l[1]=t=>s.lastName=t),label:e.$t("lastName"),class:"q-ma-md",style:{"box-shadow":"none"},"lazy-rules":"",rules:[t=>t&&t.length>0||"Required"]},null,8,["modelValue","label","rules"])])]),a("div",le,[a("div",oe,[o(v,{rounded:"",flat:"",outlined:"",modelValue:s.phone,"onUpdate:modelValue":l[2]||(l[2]=t=>s.phone=t),label:e.$t("phone"),class:"q-ma-md",style:{"box-shadow":"none"},"lazy-rules":"",rules:Q.phone},null,8,["modelValue","label","rules"])]),a("div",ne,[o(v,{rounded:"",flat:"",outlined:"",modelValue:s.email,"onUpdate:modelValue":l[3]||(l[3]=t=>s.email=t),label:"Email",class:"q-ma-md",style:{"box-shadow":"none"},"lazy-rules":"",rules:Q.email},null,8,["modelValue","rules"])])]),o(_,{class:"text-center"},{default:n(()=>[a("div",ie,[o(u,{type:"submit",label:e.$t("submit"),color:"primary",loading:s.submitting},null,8,["label","loading"])])]),_:1})]),_:1})]),_:1},8,["onSubmit"])]),_:1})]),_:1},8,["modelValue"])]),a("div",re,[a("div",de,[a("div",ce,[a("h5",ue,[o(W,{name:"mdi-cart-variant",color:"secondary",size:"lg",class:"q-mx-auto"}),m(" "+i(e.$t("cart")),1)])])]),a("div",me,[a("div",pe,[o(w,{class:"bg-accent",style:{"box-shadow":"none","border-radius":"16px"}},{default:n(()=>[_e,a("div",fe,[a("div",he,[o(B,null,{default:n(()=>[a("h5",ge,i(e.$t("totalPrice")),1),a("h4",ye,"$ "+i(f(I)),1)]),_:1}),o(G,{white:"",inset:""}),o(B,null,{default:n(()=>[(r(!0),p(A,null,z(d,t=>(r(),p("div",{key:t._id,class:"flex justify-between"},[o(q,{style:{"text-align":"left"},class:"text-dark"},{default:n(()=>[m(i(t.product.name),1)]),_:2},1024),o(q,{style:{"text-align":"right"},class:"text-dark"},{default:n(()=>[m("$ "+i(t.product.price*t.quantity),1)]),_:2},1024)]))),128))]),_:1}),o(_,null,{default:n(()=>[f(g)?(r(),c(u,{key:0,class:"text-center text-white q-my-auto q-mb-md",color:"red",onClick:l[5]||(l[5]=t=>P(""))},{default:n(()=>[m(i(e.$t("checkout")),1)]),_:1})):(r(),c(u,{key:1,class:"text-center text-white q-my-auto q-mb-md",color:"primary",disabled:""},{default:n(()=>[m(i(e.$t("checkout")),1)]),_:1})),!f(g)&&!d.length?(r(),p("p",xe,i(e.$t("noCart")),1)):f(g)?H("",!0):(r(),p("p",be,i(e.$t("checkAgain")),1))]),_:1})])])]),_:1})]),a("div",ve,[a("div",we,[(r(!0),p(A,null,z(d,(t,x)=>(r(),p("div",{class:"col-12 col-md-6 col-lg-4",key:t._id},[(r(),c(w,{class:"my-card q-pa-sm",key:t,style:{background:"transparent","box-shadow":"none","border-radius":"16px"}},{default:n(()=>[o(S,{src:t.product.image},{default:n(()=>[a("div",ke,[a("div",qe,[a("div",Ce,i(t.product.name),1),a("div",Ne,"$"+i(t.product.price),1)]),a("div",Qe,i(new Date(t.product.startDay).toDateString().toLocaleString())+" ~ "+i(new Date(t.product.endDay).toDateString().toLocaleString()),1),o(O,{class:"flex justify-between q-px-none",style:{"padding-left":"0"}},{default:n(()=>[a("div",$e,[(r(),c(u,{round:"",flat:"",key:t._id,class:"text-accent",icon:"fa-solid fa-circle-minus",onClick:C=>y(x,t.quantity-1)},null,8,["onClick"])),o(q,null,{default:n(()=>[m(i(t.quantity),1)]),_:2},1024),(r(),c(u,{round:"",flat:"",key:t._id,class:"text-accent",icon:"fa-solid fa-circle-plus",onClick:C=>y(x,t.quantity+1)},null,8,["onClick"]))]),f(g)?(r(),c(u,{key:0,round:"",color:"secondary",icon:"mdi-delete",onClick:C=>y(x,0)},null,8,["onClick"])):(r(),c(u,{key:1,round:"",color:"red",icon:"mdi-delete",onClick:C=>y(x,0)},null,8,["onClick"]))]),_:2},1024)])]),_:2},1032,["src"])]),_:2},1024))]))),128))])])])])]),_:1})}}};export{Re as default};
