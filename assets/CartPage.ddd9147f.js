import{ax as E,aa as w,d as q,aW as C,m as r,p as _,q as n,s as F,ab as Q,ac as k,t as l,v as o,bc as L,B as V,bd as W,be as z,C as m,x as i,W as $,Q as c,aA as M,ad as G,A as S,aB as H,ae as f,af as D,ag as B,ah as P}from"./index.93ce210a.js";import{Q as h}from"./QInput.89c23865.js";import{Q as g}from"./QCard.10d6c296.js";import{Q as J}from"./QForm.e159fab3.js";import{Q as U}from"./QCardSection.5f4ca36c.js";import{Q as K}from"./QCardActions.4fb028ee.js";const O={class:"box",style:{height:"300px"}},R=l("div",{class:"img1 q-my-auto"},null,-1),X=l("div",{class:"img2 q-my-auto"},null,-1),Y={class:"row"},Z={flat:"",class:"col",col:"10"},tt={class:"col",col:"10"},et={class:"row"},at={class:"col",col:"6"},st={class:"col",col:"6"},ot={class:"text-center q-ma-md"},lt={class:"box",style:{"margin-top":"20px"}},nt={class:"row"},it={class:"col col-12 col-md-2"},dt=l("div",{class:"row bg-secondary q-mx-auto rounded",style:{width:"80%"}},null,-1),rt={class:"col"},ct={class:"text-center text-white q-pb-lg"},ut={style:{"margin-bottom":"0","margin-top":"10px"},class:"text-dark"},mt={style:{"margin-top":"10px","margin-bottom":"10px"},class:"text-dark"},pt={class:"col col-12 col-md-10"},_t={class:"row"},ft={class:"text-h5 absolute-bottom text-right"},ht={class:"flex row justify-between"},gt={class:"text-h5 text-accent"},yt={class:"text-subtitle1"},bt={class:"text-subtitle2 text-accent",style:{"font-size":"1.5vmin"}},xt={class:"div"},$t={__name:"CartPage",setup(vt){const y=E(),p=w([]),d=w([]),A=q(()=>d.reduce((a,s)=>a+s.product.price*s.quantity,0)),I=q(()=>d.length>0&&!d.some(a=>!a.product.sell)),t=w({_id:"",firstName:"",lastName:"",phone:"",email:"",idx:-1,dialog:!1,submitting:!1}),T=a=>{t._id=a;const s=a===""?-1:y.orderInfo.findIndex(u=>u._id===a);s>-1?(t.lastName=p[s].lastName,t.firstName=p[s].firstName,t.phone=p[s].phone,t.email=p[s].email):(t.lastName="",t.firstName="",t.phone="",t.email=""),t.idx=s,t.dialog=!0,t.submitting=!1,console.log(t.lastName)},j=async()=>{t.submitting=!0;try{t._id.length===0&&(await Q.post("/users/order",{_id:t._id,lastName:t.lastName,firstName:t.firstName,phone:t.phone,email:t.email}),k.fire({icon:"success",title:"\u6210\u529F",text:"\u65B0\u589E\u8A02\u55AE\u6210\u529F"})),t.dialog=!1}catch(a){k.fire({icon:"error",title:"\u5931\u6557",text:a.isAxiosError?a.response.data.message:a.message})}t.submitting=!1,await y.checkout()},b=async(a,s)=>{await y.updateCart({product:d[a].product._id,quantity:s})&&(s===0?d.splice(a,1):d[a].quantity=s)};return(async()=>{try{const{data:a}=await Q.get("/users/cart");d.push(...a.result)}catch{k.fire({icon:"error",title:"\u5931\u6557",text:"\u4F3A\u670D\u5668\u932F\u8AA4"})}})(),(a,s)=>{const u=C("q-card-action"),x=C("h7");return r(),_(F,{id:"",class:"q-mt-md",style:{height:"calc(100% - 60px)","min-height":"calc(100% - 60px)"}},{default:n(()=>[l("div",O,[R,X,o(G,{seamless:"",modelValue:t.dialog,"onUpdate:modelValue":s[4]||(s[4]=e=>t.dialog=e),persistent:""},{default:n(()=>[o(g,{id:"dialog"},{default:n(()=>[o(L,null,{default:n(()=>[o(V,{src:W,width:"35px",style:{"margin-top":"-5px"}}),o(z,{class:"text-weight-bold text-primary"},{default:n(()=>[m(i(a.$t("contactInfo")),1)]),_:1}),$(o(c,{flat:"",round:"",dense:"",icon:"close"},null,512),[[P]])]),_:1}),o(J,{onSubmit:M(j,["prevent"])},{default:n(()=>[o(g,{flat:""},{default:n(()=>[l("div",Y,[l("div",Z,[o(h,{rounded:"",flat:"",primary:"",standout:"",modelValue:t.firstName,"onUpdate:modelValue":s[0]||(s[0]=e=>t.firstName=e),label:a.$t("firstName"),class:"q-ma-md"},null,8,["modelValue","label"])]),l("div",tt,[o(h,{rounded:"",flat:"",primary:"",standout:"",modelValue:t.lastName,"onUpdate:modelValue":s[1]||(s[1]=e=>t.lastName=e),label:a.$t("lastName"),class:"q-ma-md",style:{"box-shadow":"none"}},null,8,["modelValue","label"])])]),l("div",et,[l("div",at,[o(h,{rounded:"",flat:"",primary:"",standout:"",modelValue:t.phone,"onUpdate:modelValue":s[2]||(s[2]=e=>t.phone=e),label:a.$t("phone"),class:"q-ma-md",style:{"box-shadow":"none"}},null,8,["modelValue","label"])]),l("div",st,[o(h,{rounded:"",flat:"",primary:"",standout:"",modelValue:t.email,"onUpdate:modelValue":s[3]||(s[3]=e=>t.email=e),label:"Email",class:"q-ma-md",style:{"box-shadow":"none"}},null,8,["modelValue"])])]),o(u,{class:"text-center"},{default:n(()=>[l("div",ot,[$(o(c,{type:"submit",label:a.$t("submit"),color:"primary",loading:t.submitting},null,8,["label","loading"]),[[P]])])]),_:1})]),_:1})]),_:1},8,["onSubmit"])]),_:1})]),_:1},8,["modelValue"])]),l("div",lt,[l("div",nt,[l("div",it,[o(g,{class:"bg-accent",style:{"box-shadow":"none","border-radius":"50px"}},{default:n(()=>[dt,l("div",rt,[l("div",ct,[o(U,null,{default:n(()=>[l("h5",ut,i(a.$t("totalPrice")),1),l("h4",mt,"$ "+i(S(A)),1)]),_:1}),o(H,{white:"",inset:""}),o(U,null,{default:n(()=>[(r(!0),f(B,null,D(d,e=>(r(),f("div",{key:e._id,class:"flex justify-between"},[o(x,{style:{"text-align":"left"},class:"text-dark"},{default:n(()=>[m(i(e.product.name),1)]),_:2},1024),o(x,{style:{"text-align":"right"},class:"text-dark"},{default:n(()=>[m("$ "+i(e.product.price*e.quantity),1)]),_:2},1024)]))),128))]),_:1}),o(u,null,{default:n(()=>[o(c,{class:"text-center text-white q-my-auto q-mb-md",color:"secondary",onClick:s[5]||(s[5]=e=>T("")),disabled:!S(I)},{default:n(()=>[m(i(a.$t("checkout")),1)]),_:1},8,["disabled"])]),_:1})])])]),_:1})]),l("div",pt,[l("div",_t,[(r(!0),f(B,null,D(d,(e,v)=>(r(),f("div",{class:"col-12 col-md-6 col-lg-4",key:e._id},[(r(),_(g,{class:"my-card q-pa-sm",key:e,style:{background:"transparent","box-shadow":"none","border-radius":"50px"}},{default:n(()=>[o(V,{src:e.product.image},{default:n(()=>[l("div",ft,[l("div",ht,[l("div",gt,i(e.product.name),1),l("div",yt,"$"+i(e.product.price),1)]),l("div",bt,i(new Date(e.product.startDay).toDateString().toLocaleString())+" ~ "+i(new Date(e.product.endDay).toDateString().toLocaleString()),1),o(K,{class:"flex justify-between q-px-none",style:{"padding-left":"0"}},{default:n(()=>[l("div",xt,[(r(),_(c,{round:"",flat:"",key:e._id,class:"text-accent",icon:"fa-solid fa-circle-minus",onClick:N=>b(v,e.quantity-1)},null,8,["onClick"])),o(x,null,{default:n(()=>[m(i(e.quantity),1)]),_:2},1024),(r(),_(c,{round:"",flat:"",key:e._id,class:"text-accent",icon:"fa-solid fa-circle-plus",onClick:N=>b(v,e.quantity+1)},null,8,["onClick"]))]),o(c,{round:"",color:"secondary",icon:"mdi-delete",onClick:N=>b(v,0)},null,8,["onClick"])]),_:2},1024)])]),_:2},1032,["src"])]),_:2},1024))]))),128))])])])])]),_:1})}}};export{$t as default};
