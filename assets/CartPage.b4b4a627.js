import{ay as B,ab as g,d as x,aX as U,m as y,p as N,q as r,ac as q,ad as b,s,v as n,z as V,t as l,Q as d,bd as F,A as I,be as L,bf as A,B as c,V as D,aB as P,ae as T,af as z,ag as E,bg as M,y as Y,ah as X,ai as C}from"./index.5d83bf10.js";import{Q as p}from"./QInput.abc39afa.js";import{Q as w}from"./QCard.58209fd9.js";import{Q as j}from"./QForm.def18a60.js";import{Q as G}from"./QPage.947199e3.js";const H={class:"row bg-secondary q-mx-auto rounded",style:{width:"80%"}},J={class:"col"},K={class:"text-center text-white"},O={class:"col"},R=c("\u7D50\u5E33"),W={class:"row"},Z={flat:"",class:"col",col:"10"},tt={class:"col",col:"10"},et={class:"row"},at={class:"col",col:"6"},ot={class:"col",col:"6"},st={class:"text-center q-ma-md"},lt={class:"row q-ml-lg"},rt=["src"],nt={class:"row rounded q-pa-md",style:{width:"100%",background:"rgba(117, 181, 152, 0.5)","margin-top":"-10px"}},it={class:"col col-10"},dt=c("\u522A\u9664"),ct={class:"col col-2"},ut=c(" - "),mt=c(" + "),wt={__name:"CartPage",setup(pt){const f=B(),u=g([]),i=g([]),Q=x(()=>i.reduce((o,a)=>o+a.product.price*a.quantity,0)),k=x(()=>i.length>0&&!i.some(o=>!o.product.sell)),t=g({_id:"",firstName:"",lastName:"",phone:"",email:"",idx:-1,dialog:!1,submitting:!1}),$=o=>{t._id=o;const a=o===""?-1:f.orderInfo.findIndex(m=>m._id===o);a>-1?(t.lastName=u[a].lastName,t.firstName=u[a].firstName,t.phone=u[a].phone,t.email=u[a].email):(t.lastName="",t.firstName="",t.phone="",t.email=""),t.idx=a,t.dialog=!0,t.submitting=!1,console.log(t.lastName)},S=async()=>{t.submitting=!0;try{t._id.length===0&&(await q.post("/users/order",{_id:t._id,lastName:t.lastName,firstName:t.firstName,phone:t.phone,email:t.email}),b.fire({icon:"success",title:"\u6210\u529F",text:"\u65B0\u589E\u8A02\u55AE\u6210\u529F"})),t.dialog=!1}catch(o){b.fire({icon:"error",title:"\u5931\u6557",text:o.isAxiosError?o.response.data.message:o.message})}t.submitting=!1,await f.checkout()},_=async(o,a)=>{await f.updateCart({product:i[o].product._id,quantity:a})&&(a===0?i.splice(o,1):i[o].quantity=a)};return(async()=>{try{const{data:o}=await q.get("/users/cart");i.push(...o.result)}catch{b.fire({icon:"error",title:"\u5931\u6557",text:"\u4F3A\u670D\u5668\u932F\u8AA4"})}})(),(o,a)=>{const m=U("q-card-action");return y(),N(G,{class:"q-mt-md",style:{height:"calc(100% - 60px)","min-height":"calc(100% - 60px)"}},{default:r(()=>[s("div",H,[s("div",J,[s("h3",K," \u7E3D\u91D1\u984D $ "+n(V(Q)),1)]),s("div",O,[l(d,{class:"text-center text-white q-my-auto",color:"accent",onClick:a[0]||(a[0]=e=>$("")),disabled:!V(k)},{default:r(()=>[R]),_:1},8,["disabled"])]),l(T,{seamless:"",modelValue:t.dialog,"onUpdate:modelValue":a[5]||(a[5]=e=>t.dialog=e),persistent:""},{default:r(()=>[l(w,{id:"dialog"},{default:r(()=>[l(F,null,{default:r(()=>[l(I,{src:L,width:"35px",style:{"margin-top":"-5px"}}),l(A,{class:"text-weight-bold text-primary"},{default:r(()=>[c(n(o.$t("contactInfo")),1)]),_:1}),D(l(d,{flat:"",round:"",dense:"",icon:"close"},null,512),[[C]])]),_:1}),l(j,{onSubmit:P(S,["prevent"])},{default:r(()=>[l(w,{flat:""},{default:r(()=>[s("div",W,[s("div",Z,[l(p,{rounded:"",flat:"",primary:"",standout:"",modelValue:t.firstName,"onUpdate:modelValue":a[1]||(a[1]=e=>t.firstName=e),label:o.$t("firstName"),class:"q-ma-md"},null,8,["modelValue","label"])]),s("div",tt,[l(p,{rounded:"",flat:"",primary:"",standout:"",modelValue:t.lastName,"onUpdate:modelValue":a[2]||(a[2]=e=>t.lastName=e),label:o.$t("lastName"),class:"q-ma-md",style:{"box-shadow":"none"}},null,8,["modelValue","label"])])]),s("div",et,[s("div",at,[l(p,{rounded:"",flat:"",primary:"",standout:"",modelValue:t.phone,"onUpdate:modelValue":a[3]||(a[3]=e=>t.phone=e),label:o.$t("phone"),class:"q-ma-md",style:{"box-shadow":"none"}},null,8,["modelValue","label"])]),s("div",ot,[l(p,{rounded:"",flat:"",primary:"",standout:"",modelValue:t.email,"onUpdate:modelValue":a[4]||(a[4]=e=>t.email=e),label:"Email",class:"q-ma-md",style:{"box-shadow":"none"}},null,8,["modelValue"])])]),l(m,{class:"text-center"},{default:r(()=>[s("div",st,[D(l(d,{type:"submit",label:o.$t("submit"),color:"primary",loading:t.submitting},null,8,["label","loading"]),[[C]])])]),_:1})]),_:1})]),_:1},8,["onSubmit"])]),_:1})]),_:1},8,["modelValue"])]),(y(!0),z(X,null,E(i,(e,h)=>(y(),N(w,{flat:"",key:e._id,class:M([{"bg-red":!e.product.sell},"q-mx-auto q-ma-sm q-pa-md"]),style:{width:"90%"}},{default:r(()=>[s("div",lt,[l(Y,{size:"200px",style:{background:"white"}},{default:r(()=>[s("img",{src:e.product.image,alt:""},null,8,rt)]),_:2},1024)]),s("div",nt,[s("div",it,[s("h4",null,n(e.product.name),1),s("h6",null,"$ "+n(e.product.price),1),s("h6",null,n(new Date(e.product.startDay).getFullYear().toLocaleString())+"."+n(new Date(e.product.startDay).getMonth()+1)+"."+n(new Date(e.product.startDay).getDate().toLocaleString())+" ~ "+n(new Date(e.product.endDay).getFullYear().toLocaleString())+"."+n(new Date(e.product.endDay).getMonth()+1)+"."+n(new Date(e.product.endDay).getDate().toLocaleString()),1),c(" "+n(e.product.price*e.quantity)+" ",1),l(d,{color:"primary",onClick:v=>_(h,0)},{default:r(()=>[dt]),_:2},1032,["onClick"])]),s("div",ct,[l(d,{color:"primary",onClick:v=>_(h,e.quantity-1),variant:"text"},{default:r(()=>[ut]),_:2},1032,["onClick"]),s("h4",null,n(e.quantity),1),l(d,{color:"primary",onClick:v=>_(h,e.quantity+1),variant:"text"},{default:r(()=>[mt]),_:2},1032,["onClick"])])])]),_:2},1032,["class"]))),128))]),_:1})}}};export{wt as default};
